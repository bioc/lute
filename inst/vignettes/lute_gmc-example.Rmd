---
title: "lute_gmc-example"
author: "Sean Maden"
date: "2023-03-08"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This vignette demonstrates how to use the `deconvolution` generic to obtain
cell type proportion estimates using the `nnls::nnls()` implementation of
non-negative least squares (NNLS).

First, load `lute` and get the example datasets for a reference-based 
deconvolution method.

```{r}
library(lute)
lexample <- lute:::.get_decon_example_data()
s <- lexample[["s"]]
y <- lexample[["y"]]
z <- lexample[["z"]]
```

Use the constructor function `nnlsParam` to instantiate the parameters to use
`nnls::nnls()`.

```{r}
param <- nnlsParam(s = s, y = y, z = z)
```

We can inspect the new object `param` to see details about our deconvolution 
data inputs.

```{r}
param
```

Executing the `deconvolution` generic on `param` will run `nnls::nnls`. By default,
only the predicted cell type proportions are returned.

```{r}
deconvolution(param)
```

To get more extensive results, we can set the attribute `return.info==T` in `param`.
Running the `deconvolution` generic now returns a list containing the items
`proportions` (cell type proportion estimates), `results` (original results 
returned by the deconvolution function, `nnls::nnls` in this case), and 
`metadata` (listed metadata containing the input data summaries).

```{r}
param@return.info <- T
deconvolution(param)
```
